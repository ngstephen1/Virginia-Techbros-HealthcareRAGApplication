services:
  # --------------------
  # 1. FRONTEND SERVICE (React / Nginx)
  # --------------------
  frontend:
    # Uses the Dockerfile.frontend you provided
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      # Exposes the internal Nginx port (80) to the host machine (3000)
      - "3000:80"
    volumes:
      # Maps the Nginx config file for SPA routing and API proxying
      # NOTE: Ensure you have an 'nginx.conf' file in your project root!
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    networks:
      - research-network

  # --------------------
  # 2. BACKEND SERVICE (Flask / RAG Pipeline)
  # --------------------
  backend:
    # Uses the Dockerfile.backend you provided
    build:
      context: .
      dockerfile: Dockerfile.backend
    # Mount the code for development (optional, useful for quick restarts)
    volumes:
      - ./:/app/backend
    ports:
      # Exposes the Flask port (8000) for internal use/debugging
      - "8000:8000"
    environment:
      # CRUCIAL: Set the MongoDB connection string using the 'mongo' service name
      MONGO_URI: mongodb://mongo:27017/researchdb
      # Set the application port to match the Dockerfile
      PORT: 8000 
    depends_on:
      - mongo
    networks:
      - research-network
      
  # --------------------
  # 3. DATABASE SERVICE (MongoDB)
  # --------------------
  mongo:
    image: mongo:latest
    container_name: mongodb_research
    ports:
      # Expose MongoDB port for local tools (optional)
      - "27017:27017" 
    volumes:
      # Persistent storage for MongoDB data
      - mongo-data:/data/db
    networks:
      - research-network

# Define the network for inter-service communication
networks:
  research-network:
    driver: bridge

# Define volumes for persistent data
volumes:
  mongo-data:


# services:
#   # Frontend service (React)
#   healthcare-rag-frontend:
#     build: .
#     ports:
#       - "3000:3000"
#     environment:
#       - NODE_ENV=development
#     volumes:
#       - .:/app
#       - ./node_modules:/app/node_modules
#     stdin_open: true
#     tty: true
#     command: npm start
